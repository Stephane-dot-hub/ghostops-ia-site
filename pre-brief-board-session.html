<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>GhostOps Pré-brief Board – Espace de travail & activation</title>
    <meta name="description" content="Espace de travail GhostOps Pré-brief Board, réservé aux dirigeants et boards ayant validé le paiement. Rappel du périmètre, préparation des éléments et première structuration du dossier." />

    <meta name="robots" content="noindex, nofollow" />
    <link rel="canonical" href="https://www.ghostops.tech/pre-brief-board-session.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="GhostOps Pré-brief Board – Espace de travail" />
    <meta property="og:description" content="Session Pré-brief Board GhostOps : espace de travail confidentiel pour structurer votre note board-ready après validation du paiement." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.ghostops.tech/pre-brief-board-session.html" />
    <meta property="og:image" content="https://www.ghostops.tech/assets/ghostops-opengraph.jpg" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="GhostOps Pré-brief Board – Session" />
    <meta name="twitter:description" content="Espace de travail confidentiel réservé aux Pré-brief Board GhostOps." />
    <meta name="twitter:image" content="https://www.ghostops.tech/assets/ghostops-opengraph.jpg" />

    <!-- Fonts & Tailwind -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: { extend: { fontFamily: { sans: ['Inter','sans-serif'] } } }
      };
    </script>

    <style>
      body::before {
        content: "";
        background: url('/assets/background-ghostops.jpg') no-repeat center center fixed;
        background-color: #0f172a;
        background-size: cover;
        animation: bgPulse 10s ease-in-out infinite alternate;
        position: fixed; inset: 0; opacity: 0.25; z-index: -1;
        transition: opacity .4s ease;
      }
      @keyframes bgPulse {
        0% { filter: brightness(1) contrast(1); }
        100% { filter: brightness(1.05) contrast(1.05); }
      }
      .text-shadow { text-shadow: 1px 1px 4px rgba(0,0,0,.6); }
      html { scroll-behavior: smooth; }
      header, main, section, footer { position: relative; z-index: 1; }
    </style>
  </head>

  <body class="bg-gray-900 text-white font-sans leading-relaxed">
    <!-- HEADER -->
    <header class="w-full px-6 md:px-16 py-4 flex items-center justify-between">
      <a href="/index.html" class="text-sm font-semibold tracking-[.25em] text-gray-200 hover:text-white uppercase">
        GHOST<span class="text-gray-400">OPS</span>
      </a>
      <nav class="flex items-center gap-4 text-xs md:text-sm">
        <a href="/index.html" class="text-gray-300 hover:text-white">Accueil</a>
        <a href="/expertise.html" class="text-gray-300 hover:text-white">Expertise</a>
        <a href="/qui-sommes-nous.html" class="text-gray-300 hover:text-white">Qui sommes-nous&nbsp;?</a>
        <a href="/contact.html"
           class="px-3 py-1 border border-gray-400 rounded-full hover:bg-gray-100 hover:text-black transition">
          Contact confidentiel
        </a>
      </nav>
    </header>

    <main class="px-6 md:px-24 pb-24">
      <!-- BLOC SI PAIEMENT NON DÉTECTÉ -->
      <section id="prebrief-not-paid" class="hidden max-w-3xl mx-auto mt-10 mb-10">
        <div class="bg-red-900/40 border border-red-500/70 rounded-2xl p-6 md:p-8">
          <h1 class="text-2xl md:text-3xl font-bold mb-3 text-white text-shadow">
            Accès réservé – GhostOps Pré-brief Board
          </h1>

          <p class="text-gray-200 text-sm md:text-base mb-3">
            Cette page est réservée aux dirigeants, boards ou directions ayant validé un
            <span class="font-semibold">GhostOps Pré-brief Board</span> via le module de paiement sécurisé.
          </p>

          <p class="text-gray-300 text-sm md:text-base mb-4">
            Après paiement, vous devez utiliser le lien complet contenant un identifiant <span class="font-semibold">cs_id</span>.
          </p>

          <div class="flex flex-col sm:flex-row gap-3 mt-4">
            <a href="/pre-brief-board.html"
               class="inline-block px-5 py-2 text-xs md:text-sm border border-white rounded-md hover:bg-white hover:text-black transition text-center">
              Revenir à la page Pré-brief Board
            </a>
            <a href="/contact.html"
               class="inline-block px-5 py-2 text-xs md:text-sm border border-gray-400 rounded-md hover:bg-gray-100 hover:text-black transition text-center">
              Contacter GhostOps
            </a>
          </div>

          <p id="prebrief-debug" class="text-gray-500 text-[11px] mt-4"></p>
        </div>
      </section>

      <!-- BLOC SI PAIEMENT OK -->
      <section id="prebrief-paid" class="hidden max-w-5xl mx-auto mt-10 mb-10">
        <!-- Bandeau de confirmation -->
        <div class="bg-emerald-900/40 border border-emerald-500/70 rounded-2xl p-4 mb-6">
          <p class="text-xs md:text-sm text-emerald-100">
            Votre paiement pour le <span class="font-semibold">GhostOps Pré-brief Board</span> a été validé.
            Cet espace vous permet de préparer et structurer votre dossier pour la note board-ready.
          </p>
        </div>

        <!-- Intro -->
        <header class="mb-8">
          <p class="text-xs uppercase tracking-[.25em] text-gray-400 mb-3">
            GhostOps IA · Pré-brief Board – Espace de travail
          </p>
          <h1 class="text-2xl md:text-3xl font-bold mb-4 text-white text-shadow">
            Session Pré-brief Board – préparation de la note board-ready
          </h1>
          <p class="text-gray-200 text-sm md:text-base mb-3 max-w-3xl">
            Vous avez activé un <span class="font-semibold">Pré-brief Board GhostOps</span>. L’objectif de cette session
            est de rassembler les éléments décisifs et de structurer le contexte avant la production de la
            <span class="font-semibold">note board-ready</span> destinée à votre conseil d’administration ou comité d’audit.
          </p>
          <p class="text-gray-300 text-sm md:text-base max-w-3xl">
            GhostOps utilise l’IA comme instrument de lecture et de simulation. La note finale reste un
            <span class="font-semibold">livrable humain, assumé</span>, construit à partir de votre contexte, des échanges
            et des arbitrages que vous validerez.
          </p>
        </header>

        <!-- Étape 1 -->
        <section class="mb-8">
          <div class="bg-gray-800/80 rounded-2xl p-6 md:p-8">
            <h2 class="text-xl md:text-2xl font-semibold mb-3 text-white text-shadow">
              Étape&nbsp;1 – Préparer vos éléments de contexte
            </h2>
            <p class="text-gray-300 text-sm md:text-base mb-4 max-w-3xl">
              Avant d’utiliser l’IA, il est utile de rassembler les informations qui structurent réellement votre dossier.
              Vous pouvez vous appuyer sur la trame suivante (vous n’êtes pas obligé de tout remplir) :
            </p>
            <ul class="list-disc list-inside text-gray-300 text-sm md:text-base space-y-2 max-w-3xl">
              <li><span class="font-semibold">Périmètre concerné</span> (groupe / filiale / site / fonction…).</li>
              <li><span class="font-semibold">Situation actuelle</span> : faits, tensions, décisions en suspens.</li>
              <li><span class="font-semibold">Acteurs clés et lignes de force</span> : influence réelle, blocages.</li>
              <li><span class="font-semibold">Ce que vous cherchez à éviter</span> : crise ouverte, fuite presse, etc.</li>
              <li><span class="font-semibold">Horizon de décision</span> : board, comité, échéances.</li>
            </ul>
            <p class="text-gray-400 text-xs md:text-sm mt-4 max-w-3xl">
              Vous pouvez saisir ces éléments directement dans le module IA ci-dessous.
            </p>
          </div>
        </section>

        <!-- Étape 2 : chat -->
        <section>
          <div class="bg-gray-900/80 border border-gray-700 rounded-2xl p-6 md:p-8">
            <h2 class="text-xl md:text-2xl font-semibold mb-3 text-white text-shadow">
              Étape&nbsp;2 – Première lecture avec GhostOps IA – Pré-brief Board
            </h2>

            <div class="bg-gray-950/80 rounded-xl border border-gray-700 max-h-[360px] flex flex-col">
              <div id="prebrief-chat-messages" class="flex-1 px-4 py-3 space-y-3 overflow-y-auto text-xs md:text-sm">
                <div class="text-gray-300 text-xs md:text-[13px]">
                  <span class="font-semibold">GhostOps IA – Pré-brief Board&nbsp;:</span>
                  <span>
                    Décrivez votre situation (périmètre, faits, acteurs, risques, échéances).<br /><br />
                    Je vous proposerai une lecture structurée : enjeux, risques humains / narratifs / gouvernance,
                    et pistes de cadrage pour préparer une note board-ready.
                  </span>
                </div>
              </div>

              <form id="prebrief-chat-form" class="border-t border-gray-800 px-3 py-2 flex items-center gap-2">
                <textarea id="prebrief-chat-input"
                          class="flex-1 text-xs bg-gray-900 text-gray-100 border border-gray-700 rounded-md px-2 py-1 resize-none focus:outline-none focus:border-gray-400"
                          rows="3"
                          placeholder="Décrivez ici votre situation (contexte, acteurs, risques, échéances)…"></textarea>
                <button type="submit"
                        class="text-xs px-3 py-2 bg-white text-black font-semibold rounded-md hover:bg-gray-200">
                  Envoyer
                </button>
              </form>
            </div>

            <p class="text-gray-500 text-[11px] mt-3 max-w-3xl">
              Ce module IA ne remplace pas un échange direct. La production de la note finale reste un livrable humain.
            </p>
          </div>
        </section>
      </section>
    </main>

    <footer class="w-full px-6 md:px-24 pb-8 mt-8 text-xs text-gray-400">
      <div class="max-w-5xl mx-auto flex flex-col md:flex-row md:items-center md:justify-between gap-2">
        <p>© GhostOps – Tous droits réservés.</p>
        <nav class="flex flex-wrap items-center gap-3">
          <a href="/" class="hover:underline">Accueil</a>
          <a href="/expertise.html" class="hover:underline">Expertise</a>
          <a href="/qui-sommes-nous.html" class="hover:underline">Qui sommes-nous&nbsp;?</a>
          <a href="/contact.html" class="hover:underline">Contact</a>
          <a href="/mentions-legales.html" class="hover:underline">Mentions légales &amp; confidentialité</a>
        </nav>
      </div>
    </footer>

    <!-- Script activation + chat (cs_id + token) -->
    <script>
      (function () {
        const params = new URLSearchParams(window.location.search);
        const csId = (params.get('cs_id') || '').trim();
        const paidFlag = (params.get('paid') || '').trim();

        const paidBlock = document.getElementById('prebrief-paid');
        const notPaidBlock = document.getElementById('prebrief-not-paid');
        const debugEl = document.getElementById('prebrief-debug');

        const TOKEN_KEY = 'ghostops_prebrief_sessionToken_v1';

        function showPaid() {
          if (notPaidBlock) notPaidBlock.classList.add('hidden');
          if (paidBlock) paidBlock.classList.remove('hidden');
        }

        function showNotPaid(msg) {
          if (paidBlock) paidBlock.classList.add('hidden');
          if (notPaidBlock) notPaidBlock.classList.remove('hidden');
          if (debugEl) debugEl.textContent = msg || '';
        }

        // 1) Décision d'affichage
        // - Si paid=1 : on affiche (compat legacy)
        // - Sinon si cs_id présent : on tente une validation via API
        // - Sinon : accès refusé
        async function bootstrapAccess() {
          if (paidFlag === '1') {
            showPaid();
            return;
          }

          const existingToken = (localStorage.getItem(TOKEN_KEY) || '').trim();
          if (existingToken) {
            // On ne sait pas si token encore valide, mais on permet l'accès, l'API tranchera à l'usage.
            showPaid();
            return;
          }

          if (!csId) {
            showNotPaid('Lien incomplet : paramètre cs_id absent.');
            return;
          }

          // Tentative de validation "silencieuse" : on appelle l’API avec un message neutre.
          try {
            const r = await fetch('/api/ghostops-pre-brief-board', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                cs_id: csId,
                message: 'Validation d’accès Pré-brief Board (initialisation).'
              })
            });

            const data = await r.json().catch(() => ({}));

            if (!r.ok) {
              const errText = data.error || 'Paiement non vérifié (API).';
              showNotPaid(`cs_id détecté mais accès refusé : ${errText}`);
              return;
            }

            if (data.sessionToken) {
              localStorage.setItem(TOKEN_KEY, data.sessionToken);
              showPaid();
              return;
            }

            // Si l’API renvoie reply mais pas de token, on considère que l’API n’est pas au bon format
            showNotPaid('API Pré-brief Board : réponse reçue mais aucun sessionToken (contrat non conforme).');
          } catch (e) {
            showNotPaid('Erreur réseau lors de la validation du paiement. Réessayez ou contactez GhostOps.');
          }
        }

        // 2) Chat
        const form = document.getElementById('prebrief-chat-form');
        const input = document.getElementById('prebrief-chat-input');
        const messages = document.getElementById('prebrief-chat-messages');

        function scrollToBottom() {
          if (!messages) return;
          messages.scrollTop = messages.scrollHeight;
        }

        function addMessage(sender, text) {
          const wrapper = document.createElement('div');
          wrapper.className = sender === 'user' ? 'mb-2 text-right' : 'mb-2 text-left';

          const bubble = document.createElement('div');
          bubble.className = sender === 'user'
            ? 'inline-block bg-blue-500 text-white text-xs md:text-sm px-3 py-2 rounded-lg'
            : 'inline-block bg-gray-800 text-gray-100 text-xs md:text-sm px-3 py-2 rounded-lg';

          bubble.textContent = text;
          wrapper.appendChild(bubble);
          messages.appendChild(wrapper);
          scrollToBottom();
          return wrapper;
        }

        // Historique local minimal
        const history = [];

        async function sendMessage() {
          const userMessage = (input.value || '').trim();
          if (!userMessage) return;

          addMessage('user', userMessage);
          input.value = '';

          history.push({ role: 'user', content: userMessage });

          const waitingElem = addMessage('bot', 'Lecture Pré-brief Board en cours…');

          try {
            const token = (localStorage.getItem(TOKEN_KEY) || '').trim();
            const payload = token
              ? { sessionToken: token, message: userMessage, history }
              : { cs_id: csId, message: userMessage, history };

            const response = await fetch('/api/ghostops-pre-brief-board', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });

            let data = {};
            try { data = await response.json(); } catch (_) {}

            if (waitingElem && waitingElem.parentNode) waitingElem.parentNode.removeChild(waitingElem);

            if (!response.ok || !data.reply) {
              const errText = data.error || 'Une erreur est survenue (Pré-brief Board). Veuillez réessayer.';
              addMessage('bot', errText);
              return;
            }

            // Rotation / stockage token si fourni
            if (data.sessionToken) localStorage.setItem(TOKEN_KEY, data.sessionToken);

            addMessage('bot', data.reply);
            history.push({ role: 'assistant', content: data.reply });
          } catch (err) {
            console.error('Erreur lors de l’appel /api/ghostops-pre-brief-board :', err);
            if (waitingElem && waitingElem.parentNode) waitingElem.parentNode.removeChild(waitingElem);
            addMessage('bot', 'Erreur de connexion à GhostOps IA. Veuillez réessayer ou utiliser la page contact.');
          }
        }

        if (form && input && messages) {
          form.addEventListener('submit', (e) => { e.preventDefault(); sendMessage(); });
          input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
          });
        }

        // Go
        bootstrapAccess();
      })();
    </script>
  </body>
</html>
