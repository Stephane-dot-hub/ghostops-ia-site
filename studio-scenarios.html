<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>GhostOps Studio Scénarios – 2 à 3 trajectoires tactiques exploitables</title>
    <meta
      name="description"
      content="GhostOps Studio Scénarios : à partir d’un brief confidentiel et/ou d’un Diagnostic IA GhostOps, construction de 2 à 3 scénarios tactiques comparables avec matrices risques / gains / exposition, pour des arbitrages assumables en gouvernance."
    />

    <meta
      name="keywords"
      content="GhostOps, Studio Scénarios, scénarios tactiques, matrices de risques, gouvernance, crises RH, dirigeants exposés, jeux de pouvoir, comités d’audit, conseils d’administration"
    />
    <meta name="author" content="GhostOps IA" />
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />

    <link rel="canonical" href="https://www.ghostops.tech/studio-scenarios.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="GhostOps Studio Scénarios – 2 à 3 trajectoires tactiques exploitables" />
    <meta
      property="og:description"
      content="Niveau 2 GhostOps IA : à partir d’un brief confidentiel et/ou d’un Diagnostic IA, construction de 2 à 3 scénarios tactiques comparables, avec matrices risques / gains / exposition et recommandations assumables."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.ghostops.tech/studio-scenarios.html" />
    <meta property="og:image" content="https://www.ghostops.tech/assets/ghostops-opengraph.jpg" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="GhostOps Studio Scénarios – 2 à 3 trajectoires tactiques exploitables" />
    <meta
      name="twitter:description"
      content="À partir d’un brief confidentiel et/ou d’un Diagnostic IA GhostOps, construction de scénarios tactiques exploitables pour le board, la direction générale et les fonctions support exposées."
    />
    <meta name="twitter:image" content="https://www.ghostops.tech/assets/ghostops-opengraph.jpg" />

    <!-- Breadcrumbs -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          { "@type": "ListItem", "position": 1, "name": "Accueil", "item": "https://www.ghostops.tech/" },
          { "@type": "ListItem", "position": 2, "name": "Expertise", "item": "https://www.ghostops.tech/expertise.html" },
          { "@type": "ListItem", "position": 3, "name": "GhostOps Studio Scénarios", "item": "https://www.ghostops.tech/studio-scenarios.html" }
        ]
      }
    </script>

    <!-- WebPage -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "url": "https://www.ghostops.tech/studio-scenarios.html",
        "name": "GhostOps Studio Scénarios",
        "description": "Niveau 2 de l’offre GhostOps IA : construction de 2 à 3 scénarios tactiques détaillés à partir d’un brief confidentiel et/ou d’un Diagnostic IA, avec matrices risques / gains / exposition."
      }
    </script>

    <!-- Fonts & Tailwind -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { theme: { extend: { fontFamily: { sans: ["Inter", "sans-serif"] } } } };
    </script>

    <style>
      body::before {
        content: "";
        background: url("/assets/background-ghostops.jpg") no-repeat center center fixed;
        background-color: #0f172a;
        background-size: cover;
        animation: bgPulse 10s ease-in-out infinite alternate;
        position: fixed;
        inset: 0;
        opacity: 0.25;
        z-index: -1;
        transition: opacity 0.4s ease;
      }
      @keyframes bgPulse {
        0% { filter: brightness(1) contrast(1); }
        100% { filter: brightness(1.05) contrast(1.05); }
      }
      .text-shadow { text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.6); }
      html { scroll-behavior: smooth; }
      header, main, section, footer { position: relative; z-index: 1; }
    </style>
  </head>

  <body class="bg-gray-900 text-white font-sans leading-relaxed">
    <!-- HEADER -->
    <header class="w-full px-6 md:px-16 py-4 flex items-center justify-between">
      <a href="/index.html" class="text-sm font-semibold tracking-[.25em] text-gray-200 hover:text-white uppercase">
        GHOST<span class="text-gray-400">OPS</span>
      </a>
      <nav class="flex items-center gap-4 text-xs md:text-sm">
        <a href="/index.html" class="text-gray-300 hover:text-white">Accueil</a>
        <a href="/expertise.html" class="text-gray-300 hover:text-white">Expertise</a>
        <a href="/qui-sommes-nous.html" class="text-gray-300 hover:text-white">Qui sommes-nous&nbsp;?</a>
        <a
          href="/contact.html"
          class="px-3 py-1 border border-gray-400 rounded-full hover:bg-gray-100 hover:text-black transition"
        >
          Contact confidentiel
        </a>
      </nav>
    </header>

    <main class="px-6 md:px-24 pb-24">
      <!-- HERO / INTRO -->
      <section class="max-w-5xl mx-auto mt-8 mb-10">
        <p class="text-xs uppercase tracking-[.25em] text-gray-400 mb-3">GhostOps IA – Niveau&nbsp;2 · Studio Scénarios</p>
        <h1 class="text-3xl md:text-4xl font-bold mb-4 text-shadow">GhostOps Studio Scénarios – 2 à 3 trajectoires tactiques exploitables</h1>

        <!-- Badge niveau + tarif -->
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-gray-500 text-[11px] text-gray-200 mb-4 bg-gray-900/60">
          <span class="uppercase tracking-[.18em] text-gray-400">Niveau&nbsp;2</span>
          <span class="h-1 w-1 rounded-full bg-gray-500"></span>
          <span>Forfait de référence&nbsp;: <span class="font-semibold">1&nbsp;490&nbsp;€ TTC</span></span>
        </div>

        <p class="text-gray-200 text-sm md:text-base mb-3">
          Le <span class="font-semibold">GhostOps Studio Scénarios</span> est le niveau&nbsp;2 de l’offre GhostOps IA.
          Il peut être activé directement à partir d’un brief confidentiel, ou s’appuyer sur un
          <a href="/diagnostic-ia.html" class="text-blue-400 hover:underline font-semibold">Diagnostic IA GhostOps</a>
          déjà réalisé lorsque celui-ci existe. À partir de ces éléments, il construit
          <span class="font-semibold">2 à 3 scénarios tactiques comparables</span>&nbsp;: trajectoires possibles,
          conditions de réussite, coûts politiques et humains, expositions potentielles.
        </p>
        <p class="text-gray-300 text-sm md:text-base mb-3">
          L’objectif n’est pas d’ajouter un document théorique de plus, mais de
          <span class="font-semibold">poser noir sur blanc ce que chaque option implique réellement</span>&nbsp;:
          qui gagne, qui perd, où se situent les risques de rupture, ce qui sera assumable ou non dans deux ans
          devant un board, un régulateur ou un actionnaire.
        </p>
        <p class="text-gray-400 text-xs md:text-sm">
          Dans sa configuration standard, le Studio Scénarios est proposé sous forme de
          <span class="font-semibold">forfait à 1&nbsp;490&nbsp;€ TTC</span> (niveau&nbsp;2, hors périmètres exceptionnels ou multi-pays).
        </p>
      </section>

      <!-- CE QUE PRODUIT LE STUDIO SCÉNARIOS -->
      <section class="max-w-5xl mx-auto mb-12">
        <h2 class="text-xl md:text-2xl font-semibold mb-4 text-shadow">Ce que produit le GhostOps Studio Scénarios</h2>

        <div class="space-y-5 text-sm md:text-base">
          <div class="bg-gray-800/80 rounded-xl p-5">
            <h3 class="font-semibold text-white mb-2">1. Deux à trois scénarios tactiques comparables</h3>
            <p class="text-gray-300">
              À partir des éléments disponibles (brief confidentiel et/ou Diagnostic IA GhostOps), construction de 2 à 3 scénarios possibles,
              formulés de manière suffisamment concrète pour être discutés en direction générale ou en board, sans ambiguïté sur ce qui est réellement proposé.
            </p>
          </div>

          <div class="bg-gray-800/80 rounded-xl p-5">
            <h3 class="font-semibold text-white mb-2">2. Matrices risques / gains / exposition</h3>
            <p class="text-gray-300">
              Pour chaque scénario, une lecture structurée des gains potentiels, des risques humains, sociaux, de gouvernance et réputationnels,
              ainsi que du niveau d’exposition personnelle des dirigeants impliqués.
            </p>
          </div>

          <div class="bg-gray-800/80 rounded-xl p-5">
            <h3 class="font-semibold text-white mb-2">3. Conditions de faisabilité</h3>
            <p class="text-gray-300">
              Identification des prérequis de mise en œuvre&nbsp;: alignements nécessaires, points de rupture possibles, séquence minimale
              (ce qui doit se faire avant, pendant, après), zones où un arbitrage clair du board est indispensable.
            </p>
          </div>

          <div class="bg-gray-800/80 rounded-xl p-5">
            <h3 class="font-semibold text-white mb-2">4. Recommandation explicite ou cadrage neutre</h3>
            <p class="text-gray-300">
              Selon votre mandat, le Studio Scénarios peut soit formuler une recommandation nette, soit se limiter à un cadrage neutre de la comparaison,
              pour laisser la décision formelle au board ou au comité d’audit.
            </p>
          </div>
        </div>
      </section>

      <!-- POUR QUI LE STUDIO SCÉNARIOS EST-IL PERTINENT ? -->
      <section class="max-w-5xl mx-auto mb-12">
        <h2 class="text-xl md:text-2xl font-semibold mb-4 text-shadow">Pour qui le Studio Scénarios est-il pertinent&nbsp;?</h2>
        <div class="grid md:grid-cols-3 gap-6 text-sm">
          <div class="bg-gray-800/70 rounded-xl p-5">
            <h3 class="font-semibold mb-2">PDG &amp; directions générales</h3>
            <p class="text-gray-300">Lorsque plusieurs options sont sur la table (maintenir, restructurer, remplacer, négocier) et qu’il devient risqué de continuer à trancher “à l’instinct”, sans grille comparée.</p>
          </div>
          <div class="bg-gray-800/70 rounded-xl p-5">
            <h3 class="font-semibold mb-2">Boards &amp; comités d’audit</h3>
            <p class="text-gray-300">Quand un dossier sensible remonte avec des signaux contradictoires&nbsp;: besoin de voir apparaître clairement les options, leurs risques et leur cohérence avec le mandat du conseil.</p>
          </div>
          <div class="bg-gray-800/70 rounded-xl p-5">
            <h3 class="font-semibold mb-2">DRH &amp; fonctions support exposées</h3>
            <p class="text-gray-300">Lorsque vous êtes au cœur de la mise en œuvre, mais que les décisions d’orientation dépassent votre périmètre formel et doivent être assumées plus haut dans la gouvernance.</p>
          </div>
        </div>
      </section>

      <!-- COMMENT SE DÉROULE UN STUDIO SCÉNARIOS ? -->
      <section class="max-w-5xl mx-auto mb-12">
        <h2 class="text-xl md:text-2xl font-semibold mb-4 text-shadow">Comment se déroule un GhostOps Studio Scénarios&nbsp;?</h2>
        <ol class="list-decimal list-inside text-gray-300 text-sm md:text-base space-y-2 max-w-3xl mb-4">
          <li><span class="font-semibold">Lecture initiale structurée</span>&nbsp;: à partir de votre brief confidentiel et/ou d’un Diagnostic IA GhostOps existant, clarification du périmètre, des faits, des acteurs, des tensions et des échéances.</li>
          <li><span class="font-semibold">Cadrage des contraintes réelles</span>&nbsp;: mandat, délais, lignes rouges (juridiques, sociales, réputationnelles), marges de manœuvre réelles du board et des dirigeants impliqués.</li>
          <li><span class="font-semibold">Construction des scénarios</span>&nbsp;: formulation de 2 à 3 trajectoires crédibles, ni caricaturales ni idéales, avec pour chacune les points durs, les relais possibles et les coûts de non-décision.</li>
          <li><span class="font-semibold">Mise en forme des matrices</span>&nbsp;: risques, gains, exposition, faisabilité, horizon temporel. L’objectif&nbsp;: rendre la comparaison intelligible en quelques minutes pour des décideurs déjà sous pression.</li>
          <li><span class="font-semibold">Revue et verrouillage</span>&nbsp;: ajustement du ton et du niveau de détail, puis stabilisation d’une version exploitable en direction générale ou en board.</li>
        </ol>
        <p class="text-gray-400 text-xs md:text-sm max-w-3xl">
          Le Studio Scénarios prépare le terrain pour un éventuel
          <a href="/pre-brief-board.html" class="text-blue-400 hover:underline">GhostOps Pré-brief Board</a> (niveau&nbsp;3), si le dossier doit être formellement porté en conseil.
        </p>
      </section>

      <!-- CE QUE LE STUDIO SCÉNARIOS N’EST PAS -->
      <section class="max-w-5xl mx-auto mb-12">
        <h2 class="text-xl md:text-2xl font-semibold mb-4 text-shadow">Ce que le Studio Scénarios n’est pas</h2>
        <div class="bg-gray-800/80 rounded-xl p-6 text-sm md:text-base space-y-3">
          <p class="text-gray-300">Le Studio Scénarios n’est ni un business plan, ni un “pack de slides” destiné à vendre une décision déjà prise, ni un substitut aux avis juridiques ou de conformité.</p>
          <ul class="list-disc list-inside text-gray-300 space-y-1">
            <li>Il ne valide pas des manœuvres contraires au cadre légal ou aux politiques internes.</li>
            <li>Il ne sert pas à maquiller une absence de décision en “étude de scénarios” permanente.</li>
            <li>Il ne prétend pas supprimer les tensions&nbsp;: il les rend visibles et arbitrables.</li>
          </ul>
          <p class="text-gray-300">
            Son rôle est de fournir une <span class="font-semibold">grille de lecture solide</span> pour des décisions difficiles, en assumant que certaines options fermeront définitivement des portes – et que d’autres exposeront certains acteurs plus que d’autres.
          </p>
        </div>
      </section>

      <!-- PARCOURS GHOSTOPS IA EN 3 NIVEAUX -->
      <section class="max-w-5xl mx-auto mb-12">
        <h2 class="text-xl md:text-2xl font-semibold mb-4 text-shadow">Parcours GhostOps IA en 3 niveaux</h2>
        <div class="bg-gray-800/70 rounded-2xl p-6 md:p-8 text-sm md:text-base">
          <div class="grid md:grid-cols-3 gap-6">
            <div>
              <p class="text-xs uppercase tracking-[.18em] text-gray-400 mb-1">Niveau&nbsp;1</p>
              <h3 class="font-semibold mb-1"><a href="/diagnostic-ia.html" class="hover:underline">Diagnostic IA – 90&nbsp;minutes</a></h3>
              <p class="text-gray-300 text-sm">Lecture IA structurée de la situation, risques principaux, premières options de lecture.</p>
            </div>
            <div>
              <p class="text-xs uppercase tracking-[.18em] text-gray-400 mb-1">Niveau&nbsp;2</p>
              <h3 class="font-semibold mb-1">GhostOps Studio Scénarios</h3>
              <p class="text-gray-300 text-sm">2 à 3 scénarios tactiques détaillés, matrices risques / gains / exposition, conditions de faisabilité, à partir de votre situation et/ou d’un Diagnostic IA existant.</p>
            </div>
            <div>
              <p class="text-xs uppercase tracking-[.18em] text-gray-400 mb-1">Niveau&nbsp;3</p>
              <h3 class="font-semibold mb-1"><a href="/pre-brief-board.html" class="hover:underline">GhostOps Pré-brief Board</a></h3>
              <p class="text-gray-300 text-sm">Note de gouvernance “board-ready” pour un conseil d’administration ou un comité d’audit.</p>
            </div>
          </div>
          <p class="mt-4 text-[11px] text-gray-400">
            Le paiement pour le <span class="font-semibold">Niveau&nbsp;2 – GhostOps Studio Scénarios</span> est distinct du Diagnostic IA (niveau&nbsp;1) et du Pré-brief Board (niveau&nbsp;3). Chaque niveau fait l’objet de son propre périmètre et de ses propres honoraires.
          </p>
          <p class="mt-1 text-[11px] text-gray-400">
            Les trois niveaux GhostOps IA peuvent être activés de manière indépendante, en fonction de la maturité de votre dossier et de vos besoins. Le parcours complet 1 → 2 → 3 est fréquent dans les situations les plus sensibles, mais il n’est jamais imposé.
          </p>
        </div>
      </section>

      <!-- CHAT D’ORIENTATION GHOSTOPS IA – STUDIO SCÉNARIOS -->
      <section id="ghostops-orientation" class="max-w-5xl mx-auto mb-12">
        <div class="bg-gray-800/80 rounded-2xl p-6 md:p-8">
          <h2 class="text-xl md:text-2xl font-semibold mb-3 text-white text-shadow">Chat d’orientation GhostOps IA – Studio Scénarios</h2>
          <p class="text-gray-300 text-sm md:text-base mb-3">
            Si vous hésitez entre plusieurs formats GhostOps ou si vous ne savez pas si le Studio Scénarios est adapté à votre dossier, vous pouvez décrire brièvement votre situation ci-dessous.
            Le moteur GhostOps IA vous propose une orientation structurée (sans se substituer à un échange humain confidentiel).
          </p>
          <p class="text-gray-400 text-xs md:text-sm mb-4">
            Ce module ne remplace pas une analyse complète ni un conseil juridique&nbsp;: il vous aide à cadrer le type d’activation GhostOps le plus pertinent (Diagnostic IA, Studio Scénarios, Pré-brief Board, autre).
          </p>

          <form id="ghostops-orientation-form" class="space-y-4">
            <div>
              <label for="ghostops-orientation-message" class="block text-xs font-semibold text-gray-200 mb-1">
                Décrivez en quelques lignes votre situation (obligatoire)
              </label>
              <textarea
                id="ghostops-orientation-message"
                class="w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-sm text-gray-100 focus:outline-none focus:border-gray-400"
                rows="4"
                placeholder="Exemple : conflit ouvert entre un dirigeant de filiale et la DRH groupe, signaux de rupture, pressions internes, incertitude sur la prochaine étape…"
                required
              ></textarea>
            </div>

            <div class="pt-2">
              <button
                type="submit"
                class="inline-block px-6 py-3 border border-white rounded-md hover:bg-white hover:text-black transition font-semibold text-sm"
              >
                Lancer le chat d’orientation GhostOps IA
              </button>
              <p id="ghostops-orientation-status" class="mt-3 text-xs text-gray-300"></p>
            </div>
          </form>

          <div
            id="ghostops-orientation-answer"
            class="mt-4 text-xs md:text-sm text-gray-100 whitespace-pre-line hidden bg-gray-900/70 border border-gray-700 rounded-lg p-4"
          ></div>

          <p class="mt-4 text-[11px] text-gray-400">
            Les réponses générées par l’IA GhostOps ont pour vocation d’éclairer votre réflexion et de vous orienter dans le choix du bon niveau GhostOps.
            Elles ne constituent ni un avis juridique, ni une recommandation engageante. Pour tout dossier sensible, un contact direct et confidentiel peut être organisé.
          </p>
        </div>
      </section>

      <!-- ACCÈS & CADRE D’HONORAIRES + CTA -->
      <section class="max-w-5xl mx-auto mt-8">
        <div class="bg-gray-800/80 rounded-2xl p-6 md:p-8">
          <h2 class="text-xl md:text-2xl font-semibold mb-3 text-white text-shadow">Accès au GhostOps Studio Scénarios &amp; honoraire de référence</h2>

          <p class="text-gray-300 text-sm md:text-base mb-3">L’accès au Studio Scénarios peut se faire de deux manières&nbsp;:</p>
          <ul class="list-disc list-inside text-gray-300 text-sm md:text-base mb-3 space-y-1">
            <li>directement, à partir d’un brief confidentiel partagé via la page contact GhostOps&nbsp;;</li>
            <li>
              à partir d’un <a href="/diagnostic-ia.html" class="text-blue-400 hover:underline font-semibold">Diagnostic IA GhostOps</a>
              déjà réalisé, qui sert alors de base de travail.
            </li>
          </ul>

          <p class="text-gray-300 text-sm md:text-base mb-3">
            Dans tous les cas, une phase de cadrage initial est intégrée pour sécuriser les hypothèses de travail, les lignes rouges et le niveau d’exposition acceptable pour la gouvernance.
          </p>
          <p class="text-gray-300 text-sm md:text-base mb-3">
            Dans le cas standard (périmètre limité à une entité ou une BU, un dossier identifié, un board / comité d’audit clairement défini), le Studio Scénarios est proposé à un
            <span class="font-semibold">forfait de 1&nbsp;490&nbsp;€ TTC</span>.
          </p>
          <p class="text-gray-400 text-xs md:text-sm mb-4">
            En cas de périmètre plus large (multi-pays, multi-boards, exposition réglementaire élevée), un ajustement peut être proposé après examen de votre brief ou, le cas échéant, de votre Diagnostic IA.
            Si le niveau Studio Scénarios n’est pas adapté, cela vous est indiqué clairement.
          </p>

          <div class="text-center mt-4">
            <p class="text-sm md:text-base text-gray-200 mb-2">
              Honoraire de référence Studio Scénarios&nbsp;: <span class="font-semibold">1&nbsp;490&nbsp;€ TTC</span>
            </p>

            <!-- ✅ CTA principal (paiement) -->
            <a
              id="studioPayBtn"
              href="/paiement-studio-scenarios.html"
              class="inline-block px-6 py-3 border border-white rounded-md hover:bg-white hover:text-black transition font-semibold text-xs md:text-sm"
            >
              Procéder au paiement sécurisé du Studio Scénarios
            </a>

            <!-- ✅ CTA alternatif (si droit déjà actif) -->
            <a
              id="studioAccessBtn"
              href="/studio-scenarios-session.html"
              class="hidden inline-block px-6 py-3 border border-emerald-300/70 text-emerald-100 rounded-md hover:bg-emerald-100 hover:text-black transition font-semibold text-xs md:text-sm"
            >
              Accéder à votre espace Studio Scénarios
            </a>

            <p id="studioCtaHint" class="text-gray-400 text-[11px] md:text-xs mt-3">
              Aucun prélèvement n’est effectué tant que vous n’avez pas validé le paiement sur la page sécurisée. Les conditions et mentions légales applicables vous sont rappelées avant confirmation définitive.
            </p>
          </div>
        </div>
      </section>
    </main>

    <footer class="w-full px-6 md:px-24 pb-8 mt-8 md:mt-12 text-xs text-gray-400">
      <div class="max-w-5xl mx-auto flex flex-col md:flex-row md:items-center md:justify-between gap-2">
        <p>© GhostOps – Tous droits réservés.</p>
        <nav class="flex flex-wrap items-center gap-3">
          <a href="/" class="hover:underline">Accueil</a>
          <a href="/expertise.html" class="hover:underline">Expertise</a>
          <a href="/qui-sommes-nous.html" class="hover:underline">Qui sommes-nous&nbsp;?</a>
          <a href="/contact.html" class="hover:underline">Contact</a>
          <a href="/mentions-legales.html" class="hover:underline">Mentions légales &amp; confidentialité</a>
        </nav>
      </div>
    </footer>

    <!-- 1) SDK Supabase (optionnel sur page produit, pour adapter le CTA si déjà payé) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- 2) config.js browser-only : doit créer window.ghostopsSupabase -->
    <script src="/config.js"></script>

    <!-- ✅ Script CTA : ajoute next=... au paiement + affiche “Accéder” si droit actif -->
    <script>
      (async function studioCtaController() {
        const payBtn = document.getElementById("studioPayBtn");
        const accessBtn = document.getElementById("studioAccessBtn");
        const hint = document.getElementById("studioCtaHint");

        const SESSION_PATH = "/studio-scenarios-session.html";

        function sanitizeInternalPath(p, fallback) {
          const fb = fallback ?? null;
          const v = String(p || "").trim();
          if (!v) return fb;
          if (v.startsWith("http://") || v.startsWith("https://")) return fb; // sécurité
          if (!v.startsWith("/")) return "/" + v;
          return v;
        }

        function currentNextFromUrl() {
          const u = new URL(window.location.href);
          return sanitizeInternalPath(u.searchParams.get("next"), null);
        }

        // 1) Toujours injecter next vers la session (ou préserver next si fourni)
        const next = currentNextFromUrl() || SESSION_PATH;
        if (payBtn) {
          const u = new URL(payBtn.getAttribute("href"), window.location.origin);
          u.searchParams.set("next", next);
          payBtn.setAttribute("href", u.pathname + "?" + u.searchParams.toString());
        }
        if (accessBtn) accessBtn.setAttribute("href", next);

        // 2) Si Supabase dispo, et droit Studio actif : on propose directement l’accès
        const supabase = window.ghostopsSupabase;
        if (!supabase?.auth) return;

        try {
          const { data } = await supabase.auth.getSession();
          const user = data?.session?.user;
          if (!user) return;

          // Query tolérante : essaie différents schémas courants (user_id vs id_utilisateur ; actif vs active)
          async function hasActiveRight() {
            // a) schéma 1 : user_id / statut=actif
            let r = await supabase
              .from("droits")
              .select("id")
              .eq("user_id", user.id)
              .eq("niveau_produit", "studio")
              .in("statut", ["actif", "active"])
              .is("revoked_at", null)
              .maybeSingle();
            if (!r.error && r.data) return true;

            // b) schéma 2 : id_utilisateur / statut=active
            r = await supabase
              .from("droits")
              .select("id")
              .eq("id_utilisateur", user.id)
              .eq("niveau_produit", "studio")
              .in("statut", ["actif", "active"])
              .is("revoked_at", null)
              .maybeSingle();
            if (!r.error && r.data) return true;

            // c) schéma 3 : statut=active sans revoked_at
            r = await supabase
              .from("droits")
              .select("id")
              .eq("user_id", user.id)
              .eq("niveau_produit", "studio")
              .in("statut", ["actif", "active"])
              .maybeSingle();
            if (!r.error && r.data) return true;

            return false;
          }

          const ok = await hasActiveRight();
          if (ok && payBtn && accessBtn) {
            payBtn.classList.add("hidden");
            accessBtn.classList.remove("hidden");
            if (hint) {
              hint.textContent =
                "Accès détecté : votre droit Studio Scénarios est actif. Vous pouvez ouvrir directement votre espace.";
            }
          }
        } catch (_) {
          // silence : CTA paiement reste affiché
        }
      })();
    </script>

    <!-- Script chat d’orientation GhostOps IA -->
    <script>
      (function () {
        const form = document.getElementById("ghostops-orientation-form");
        if (!form) return;

        const textarea = document.getElementById("ghostops-orientation-message");
        const statusEl = document.getElementById("ghostops-orientation-status");
        const answerEl = document.getElementById("ghostops-orientation-answer");

        function ghostOpsLinkify(text) {
          if (!text) return "";
          const escaped = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
          const urlRegex = /(https?:\/\/[^\s]+)/g;
          return escaped.replace(urlRegex, function (url) {
            const cleanUrl = url.replace(/&amp;/g, "&");
            return `<a href="${cleanUrl}" class="underline decoration-dotted" target="_blank" rel="noopener">${url}</a>`;
          });
        }

        function typeWriter(text, element, charDelay, onComplete) {
          let i = 0;
          element.textContent = "";
          function step() {
            if (i < text.length) {
              element.textContent += text.charAt(i);
              i++;
              setTimeout(step, charDelay);
            } else if (typeof onComplete === "function") {
              onComplete();
            }
          }
          step();
        }

        form.addEventListener("submit", async function (e) {
          e.preventDefault();

          const message = (textarea.value || "").trim();
          if (!message) {
            statusEl.textContent = "Merci de décrire brièvement votre situation avant de lancer le chat GhostOps IA.";
            statusEl.className = "mt-3 text-xs text-red-400";
            return;
          }

          statusEl.textContent = "Analyse GhostOps IA en cours…";
          statusEl.className = "mt-3 text-xs text-gray-300";
          answerEl.classList.add("hidden");
          answerEl.innerHTML = "";

          try {
            const response = await fetch("/api/ghostops-chat", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ message, source: "studio-scenarios" }),
            });

            const data = await response.json();

            if (!response.ok || !data.reply) {
              const errText = data.error || "Une erreur est survenue côté moteur GhostOps IA – Orientation.";
              statusEl.textContent = errText;
              statusEl.className = "mt-3 text-xs text-red-400";
              return;
            }

            statusEl.textContent = "Orientation proposée ci-dessous.";
            statusEl.className = "mt-3 text-xs text-green-400";

            const fullText = data.reply;
            answerEl.classList.remove("hidden");

            typeWriter(fullText, answerEl, 10, function () {
              answerEl.innerHTML = ghostOpsLinkify(answerEl.textContent);
            });
          } catch (err) {
            console.error("Erreur lors de l’appel /api/ghostops-chat :", err);
            statusEl.textContent = "Erreur de connexion au moteur GhostOps. Veuillez réessayer ultérieurement.";
            statusEl.className = "mt-3 text-xs text-red-400";
          }
        });
      })();
    </script>
  </body>
</html>
