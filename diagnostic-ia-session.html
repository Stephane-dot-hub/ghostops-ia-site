<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>GhostOps Diagnostic IA – Session 90 minutes</title>
    <meta
      name="description"
      content="Espace de travail GhostOps Diagnostic IA – 90 minutes, réservé aux dirigeants et décideurs ayant validé le paiement. Structuration de la situation, lecture IA et premières options de lecture tactique."
    />

    <meta name="robots" content="noindex, nofollow" />
    <link rel="canonical" href="https://www.ghostops.tech/diagnostic-ia-session.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="GhostOps Diagnostic IA – Session 90 minutes" />
    <meta
      property="og:description"
      content="Session Diagnostic IA GhostOps : espace de travail confidentiel pour structurer votre situation et obtenir une première lecture IA à haute valeur décisionnelle."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.ghostops.tech/diagnostic-ia-session.html" />
    <meta property="og:image" content="https://www.ghostops.tech/assets/ghostops-opengraph.jpg" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="GhostOps Diagnostic IA – Session 90 minutes" />
    <meta
      name="twitter:description"
      content="Espace de travail confidentiel réservé aux sessions Diagnostic IA GhostOps."
    />
    <meta name="twitter:image" content="https://www.ghostops.tech/assets/ghostops-opengraph.jpg" />

    <!-- Fonts & Tailwind -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: { extend: { fontFamily: { sans: ["Inter", "sans-serif"] } } },
      };
    </script>

    <style>
      body::before {
        content: "";
        background: url("/assets/background-ghostops.jpg") no-repeat center center fixed;
        background-color: #0f172a;
        background-size: cover;
        animation: bgPulse 10s ease-in-out infinite alternate;
        position: fixed;
        inset: 0;
        opacity: 0.25;
        z-index: -1;
        transition: opacity 0.4s ease;
      }
      @keyframes bgPulse {
        0% {
          filter: brightness(1) contrast(1);
        }
        100% {
          filter: brightness(1.05) contrast(1.05);
        }
      }
      .text-shadow {
        text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.6);
      }
      html {
        scroll-behavior: smooth;
      }
      header,
      main,
      section,
      footer {
        position: relative;
        z-index: 1;
      }
    </style>
  </head>

  <body class="bg-gray-900 text-white font-sans leading-relaxed">
    <!-- HEADER -->
    <header class="w-full px-6 md:px-16 py-4 flex items-center justify-between">
      <a
        href="/index.html"
        class="text-sm font-semibold tracking-[.25em] text-gray-200 hover:text-white uppercase"
      >
        GHOST<span class="text-gray-400">OPS</span>
      </a>
      <nav class="flex items-center gap-4 text-xs md:text-sm">
        <a href="/index.html" class="text-gray-300 hover:text-white">Accueil</a>
        <a href="/expertise.html" class="text-gray-300 hover:text-white">Expertise</a>
        <a href="/qui-sommes-nous.html" class="text-gray-300 hover:text-white"
          >Qui sommes-nous&nbsp;?</a
        >
        <a
          href="/contact.html"
          class="px-3 py-1 border border-gray-400 rounded-full hover:bg-gray-100 hover:text-black transition"
        >
          Contact confidentiel
        </a>
      </nav>
    </header>

    <main class="px-6 md:px-24 pb-24">
      <!-- BLOC EN COURS DE VALIDATION -->
      <section id="diagnostic-validating" class="hidden max-w-3xl mx-auto mt-10 mb-10">
        <div class="bg-gray-900/60 border border-gray-700 rounded-2xl p-6 md:p-8">
          <h1 class="text-2xl md:text-3xl font-bold mb-3 text-white text-shadow">
            Vérification de votre accès…
          </h1>
          <p class="text-gray-200 text-sm md:text-base mb-3">
            Nous validons votre session de paiement afin d’ouvrir l’espace Diagnostic IA.
          </p>
          <p class="text-gray-400 text-xs md:text-sm">
            Si la vérification échoue, vous serez redirigé vers l’écran d’accès réservé.
          </p>
        </div>
      </section>

      <!-- BLOC SI PAIEMENT NON DÉTECTÉ -->
      <section id="diagnostic-not-paid" class="hidden max-w-3xl mx-auto mt-10 mb-10">
        <div class="bg-red-900/40 border border-red-500/70 rounded-2xl p-6 md:p-8">
          <h1 class="text-2xl md:text-3xl font-bold mb-3 text-white text-shadow">
            Accès réservé – GhostOps Diagnostic IA
          </h1>
          <p class="text-gray-200 text-sm md:text-base mb-3">
            Cette page est réservée aux dirigeants, boards ou directions ayant validé un
            <span class="font-semibold">Diagnostic IA GhostOps – 90&nbsp;minutes</span> via le module de
            paiement sécurisé.
          </p>
          <p class="text-gray-300 text-sm md:text-base mb-4">
            Si vous pensez être arrivé ici par erreur, vous pouvez revenir à la page de présentation du
            format ou nous contacter en toute confidentialité.
          </p>
          <div class="flex flex-col sm:flex-row gap-3 mt-4">
            <a
              href="/diagnostic-ia.html"
              class="inline-block px-5 py-2 text-xs md:text-sm border border-white rounded-md hover:bg-white hover:text-black transition text-center"
            >
              Revenir à la page Diagnostic IA
            </a>
            <a
              href="/contact.html"
              class="inline-block px-5 py-2 text-xs md:text-sm border border-gray-400 rounded-md hover:bg-gray-100 hover:text-black transition text-center"
            >
              Contacter GhostOps
            </a>
          </div>
          <p class="text-gray-500 text-[11px] mt-4">
            Si vous venez de procéder au paiement, vérifiez que vous utilisez bien le lien complet fourni
            en fin de parcours de paiement. En cas de doute, envoyez-nous un message via la page contact.
          </p>
        </div>
      </section>

      <!-- BLOC SI SESSION EXPIRÉE / LIMITES ATTEINTES -->
      <section id="diagnostic-expired" class="hidden max-w-3xl mx-auto mt-10 mb-10">
        <div class="bg-amber-900/30 border border-amber-500/70 rounded-2xl p-6 md:p-8">
          <h1 class="text-2xl md:text-3xl font-bold mb-3 text-white text-shadow">
            Session terminée
          </h1>
          <p class="text-gray-200 text-sm md:text-base mb-3">
            Cette session Diagnostic IA est arrivée à son terme (expiration ou itérations consommées).
          </p>
          <p class="text-gray-300 text-sm md:text-base mb-4">
            Si vous souhaitez poursuivre, GhostOps peut enclencher un <span class="font-semibold">Studio Scénarios</span>
            ou produire une note <span class="font-semibold">Pré-brief Board</span>.
          </p>
          <div class="flex flex-col sm:flex-row gap-3 mt-4">
            <a
              href="/studio-scenarios.html"
              class="inline-block px-5 py-2 text-xs md:text-sm border border-white rounded-md hover:bg-white hover:text-black transition text-center"
            >
              Découvrir le Studio Scénarios
            </a>
            <a
              href="/contact.html"
              class="inline-block px-5 py-2 text-xs md:text-sm border border-gray-400 rounded-md hover:bg-gray-100 hover:text-black transition text-center"
            >
              Contacter GhostOps
            </a>
          </div>
          <p class="text-gray-500 text-[11px] mt-4">
            Si vous venez juste de payer et que vous voyez cet écran, contactez-nous : un problème de session peut exister.
          </p>
        </div>
      </section>

      <!-- BLOC SI PAIEMENT OK -->
      <section id="diagnostic-paid" class="hidden max-w-5xl mx-auto mt-10 mb-10">
        <!-- Bandeau de confirmation -->
        <div class="bg-emerald-900/40 border border-emerald-500/70 rounded-2xl p-4 mb-6">
          <p class="text-xs md:text-sm text-emerald-100">
            Accès <span class="font-semibold">GhostOps Diagnostic IA – 90&nbsp;minutes</span> validé.<br />
            Cette session inclut <span class="font-semibold">5 itérations</span> (questions / approfondissements) et une fenêtre de temps limitée.
          </p>
        </div>

        <!-- Intro -->
        <header class="mb-8">
          <p class="text-xs uppercase tracking-[.25em] text-gray-400 mb-3">
            GhostOps IA · Diagnostic – Espace de travail 90&nbsp;minutes
          </p>
          <h1 class="text-2xl md:text-3xl font-bold mb-4 text-white text-shadow">
            Session Diagnostic IA – structurer la lecture de votre situation
          </h1>
          <p class="text-gray-200 text-sm md:text-base mb-3 max-w-3xl">
            L’objectif de cette session est de clarifier votre contexte, de mettre en lumière les risques humains,
            narratifs et de gouvernance, et d’ouvrir <span class="font-semibold">2 à 3 options de lecture</span>.
          </p>
          <p class="text-gray-300 text-sm md:text-base max-w-3xl mb-3">
            Vous pouvez poser <span class="font-semibold">jusqu’à 5 questions</span> (itérations) pour approfondir.
          </p>
          <p class="text-gray-400 text-xs md:text-sm max-w-3xl">
            Bon usage : 1) description complète, 2) décisions à 10 jours, 3) options A/B/C, 4) angles morts, 5) conditions de succès.
          </p>
        </header>

        <!-- Étape 1 -->
        <section class="mb-8">
          <div class="bg-gray-800/80 rounded-2xl p-6 md:p-8">
            <h2 class="text-xl md:text-2xl font-semibold mb-3 text-white text-shadow">
              Étape&nbsp;1 – Poser les éléments de contexte
            </h2>
            <p class="text-gray-300 text-sm md:text-base mb-4 max-w-3xl">
              Le Diagnostic IA gagne en précision si vous structurez quelques éléments avant de lancer la première lecture.
              Vous pouvez vous appuyer sur la trame suivante (sans obligation de tout remplir)&nbsp;:
            </p>
            <ul class="list-disc list-inside text-gray-300 text-sm md:text-base space-y-2 max-w-3xl">
              <li>
                <span class="font-semibold">Périmètre concerné</span> (groupe / filiale / site / fonction, sans noms
                si vous préférez rester anonymisé).
              </li>
              <li>
                <span class="font-semibold">Situation actuelle</span> : faits observables, tensions, décisions en suspens,
                signaux faibles.
              </li>
              <li>
                <span class="font-semibold">Acteurs et lignes de force</span> : qui détient réellement le levier&nbsp;?
                Qui freine, qui accélère, qui est exposé publiquement&nbsp;?
              </li>
              <li>
                <span class="font-semibold">Ce que vous cherchez à éviter</span> : rupture de mandat, crise sociale,
                conflit de gouvernance, fuite presse, etc.
              </li>
              <li>
                <span class="font-semibold">Horizon de décision</span> : dates clés (board, comité, échéance sociale…).
              </li>
            </ul>
            <p class="text-gray-400 text-xs md:text-sm mt-4 max-w-3xl">
              Conseil : après la première note, utilisez vos itérations pour demander des clarifications ciblées
              (priorités, zones d’ombre, options, conditions de succès, risques narratifs).
            </p>
          </div>
        </section>

        <!-- Étape 2 -->
        <section>
          <div class="bg-gray-900/80 border border-gray-700 rounded-2xl p-6 md:p-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-3">
              <div>
                <h2 class="text-xl md:text-2xl font-semibold text-white text-shadow">
                  Étape&nbsp;2 – Module IA (5 itérations)
                </h2>
                <p class="text-gray-300 text-sm md:text-base mt-1 max-w-3xl">
                  Le module ci-dessous permet une <span class="font-semibold">lecture IA structurée</span> de votre situation.
                </p>
              </div>

              <!-- Compteurs -->
              <div class="flex flex-col items-start md:items-end gap-2">
                <div
                  id="diag-iter-badge"
                  class="text-[11px] md:text-xs px-3 py-2 rounded-full border border-gray-600 bg-gray-900/60 text-gray-200"
                >
                  Itérations restantes : <span id="diag-iter-count" class="font-semibold">5</span>/5
                </div>
                <div
                  id="diag-expiry-badge"
                  class="text-[11px] md:text-xs px-3 py-2 rounded-full border border-gray-600 bg-gray-900/60 text-gray-200"
                  title="Cette session expire automatiquement."
                >
                  Expire dans : <span id="diag-expiry-countdown" class="font-semibold">—</span>
                </div>
              </div>
            </div>

            <!-- Zone d'échanges IA -->
            <div class="bg-gray-950/80 rounded-xl border border-gray-700 max-h-[360px] flex flex-col">
              <!-- Messages -->
              <div
                id="diagnostic-chat-messages"
                class="flex-1 px-4 py-3 space-y-3 overflow-y-auto text-xs md:text-sm"
              >
                <div class="text-gray-300 text-xs md:text-[13px]">
                  <span class="font-semibold">GhostOps IA – Diagnostic&nbsp;:</span>
                  <span>
                    Décrivez votre situation en quelques paragraphes (même anonymisée).<br /><br />
                    Ensuite, utilisez vos 5 itérations pour approfondir : décisions à 10 jours, options A/B/C, angles morts, conditions de succès.
                  </span>
                </div>
              </div>

              <!-- Formulaire -->
              <form
                id="diagnostic-chat-form"
                class="border-t border-gray-800 px-3 py-2 flex items-center gap-2"
              >
                <textarea
                  id="diagnostic-chat-input"
                  class="flex-1 text-xs bg-gray-900 text-gray-100 border border-gray-700 rounded-md px-2 py-1 resize-none focus:outline-none focus:border-gray-400"
                  rows="3"
                  placeholder="Décrivez ici votre situation (contexte, acteurs, risques, échéances)…"
                ></textarea>

                <button
                  id="diagnostic-send-btn"
                  type="submit"
                  class="text-xs px-3 py-2 bg-white text-black font-semibold rounded-md hover:bg-gray-200 disabled:opacity-60 disabled:cursor-not-allowed"
                >
                  Envoyer
                </button>
              </form>
            </div>

            <p class="text-gray-500 text-[11px] mt-3 max-w-3xl">
              Ce module IA ne remplace pas un échange direct. Il fournit une lecture structurée, non un avis juridique ni un plan d’exécution.
            </p>
          </div>
        </section>
      </section>
    </main>

    <footer class="w-full px-6 md:px-24 pb-8 mt-8 text-xs text-gray-400">
      <div class="max-w-5xl mx-auto flex flex-col md:flex-row md:items-center md:justify-between gap-2">
        <p>© GhostOps – Tous droits réservés.</p>
        <nav class="flex flex-wrap items-center gap-3">
          <a href="/" class="hover:underline">Accueil</a>
          <a href="/expertise.html" class="hover:underline">Expertise</a>
          <a href="/qui-sommes-nous.html" class="hover:underline">Qui sommes-nous&nbsp;?</a>
          <a href="/contact.html" class="hover:underline">Contact</a>
          <a href="/mentions-legales.html" class="hover:underline">Mentions légales &amp; confidentialité</a>
        </nav>
      </div>
    </footer>

    <!-- Script : validation Stripe (cs_id) + session token + module IA -->
    <script>
      (function () {
        const params = new URLSearchParams(window.location.search);
        const csId = params.get("cs_id"); // Stripe Checkout Session ID

        const validatingBlock = document.getElementById("diagnostic-validating");
        const paidBlock = document.getElementById("diagnostic-paid");
        const notPaidBlock = document.getElementById("diagnostic-not-paid");
        const expiredBlock = document.getElementById("diagnostic-expired");

        const iterCountEl = document.getElementById("diag-iter-count");
        const iterBadgeEl = document.getElementById("diag-iter-badge");
        const expiryEl = document.getElementById("diag-expiry-countdown");

        const form = document.getElementById("diagnostic-chat-form");
        const input = document.getElementById("diagnostic-chat-input");
        const messages = document.getElementById("diagnostic-chat-messages");
        const sendBtn = document.getElementById("diagnostic-send-btn");

        const MAX_ITERS = 5;

        // Token GhostOps (obtenu après validation Stripe)
        let sessionToken = "";
        let itersLeft = MAX_ITERS;
        let expiresAtMs = 0;
        let countdownTimer = null;

        // Historique pour itérations (envoyé au backend)
        const convo = []; // [{role:'user'|'assistant', content:'...'}]

        function show(el) {
          if (el) el.classList.remove("hidden");
        }
        function hide(el) {
          if (el) el.classList.add("hidden");
        }

        function scrollToBottom() {
          messages.scrollTop = messages.scrollHeight;
        }

        function addMessage(sender, text) {
          const wrapper = document.createElement("div");
          wrapper.className = sender === "user" ? "mb-2 text-right" : "mb-2 text-left";

          const bubble = document.createElement("div");
          bubble.className =
            sender === "user"
              ? "inline-block bg-blue-500 text-white text-xs md:text-sm px-3 py-2 rounded-lg"
              : "inline-block bg-gray-800 text-gray-100 text-xs md:text-sm px-3 py-2 rounded-lg";

          bubble.textContent = text;
          wrapper.appendChild(bubble);
          messages.appendChild(wrapper);
          scrollToBottom();
          return { wrapper, bubble };
        }

        function setLockedUI(locked) {
          if (!sendBtn || !input) return;
          sendBtn.disabled = locked;
          input.disabled = locked;
        }

        function renderIters() {
          if (iterCountEl) iterCountEl.textContent = String(itersLeft);

          if (!iterBadgeEl) return;
          if (itersLeft <= 0) {
            iterBadgeEl.classList.add("border-amber-400", "text-amber-200");
            setLockedUI(true);
          } else {
            iterBadgeEl.classList.remove("border-amber-400", "text-amber-200");
            setLockedUI(false);
          }
        }

        function fmtCountdown(msLeft) {
          const s = Math.max(0, Math.floor(msLeft / 1000));
          const mm = String(Math.floor(s / 60)).padStart(2, "0");
          const ss = String(s % 60).padStart(2, "0");
          return `${mm}:${ss}`;
        }

        function startCountdown() {
          if (!expiryEl || !expiresAtMs) return;

          if (countdownTimer) clearInterval(countdownTimer);
          countdownTimer = setInterval(() => {
            const now = Date.now();
            const msLeft = expiresAtMs - now;

            expiryEl.textContent = fmtCountdown(msLeft);

            if (msLeft <= 0) {
              clearInterval(countdownTimer);
              countdownTimer = null;
              setLockedUI(true);
              hide(validatingBlock);
              hide(paidBlock);
              hide(notPaidBlock);
              show(expiredBlock);
            }
          }, 500);

          expiryEl.textContent = fmtCountdown(expiresAtMs - Date.now());
        }

        function hardEndToExpiredScreen(message) {
          setLockedUI(true);
          if (message) addMessage("bot", message);
          hide(validatingBlock);
          hide(paidBlock);
          hide(notPaidBlock);
          show(expiredBlock);
        }

        // ✅ NOUVEAU : on ne valide plus via /api/ghostops-diagnostic-session.
        // On effectue la validation au 1er "send" via /api/ghostops-diagnostic-ia avec cs_id.
        async function openPaidUIOrFallback() {
          hide(notPaidBlock);
          hide(expiredBlock);
          show(validatingBlock);

          if (!csId) {
            hide(validatingBlock);
            show(notPaidBlock);
            return;
          }

          // On n'appelle pas l'API ici (pas de "message" encore).
          // On ouvre l’UI, et le premier envoi déclenchera la validation Stripe + token serveur.
          hide(validatingBlock);
          show(paidBlock);
          renderIters();
          // Le compte à rebours commencera dès qu'on aura expiresAt du serveur.
          if (expiryEl) expiryEl.textContent = "—";
        }

        // Effet typewriter
        let isTyping = false;
        function addBotMessageTypewriter(text) {
          const { bubble } = addMessage("bot", "");
          let index = 0;
          isTyping = true;
          setLockedUI(true);

          function step() {
            if (index < text.length) {
              bubble.textContent += text.charAt(index);
              index += 1;
              scrollToBottom();
              setTimeout(step, 12);
            } else {
              isTyping = false;
              const ok = itersLeft > 0 && (!expiresAtMs || Date.now() < expiresAtMs);
              setLockedUI(!ok);
            }
          }

          step();
        }

        function lockIfNoIters() {
          if (itersLeft > 0) return false;
          hardEndToExpiredScreen(
            "Limite atteinte : vos 5 itérations ont été utilisées. Pour poursuivre, basculez vers le Studio Scénarios ou contactez GhostOps."
          );
          return true;
        }

        // ✅ IMPORTANT : l’API sécurisée renvoie itersLeft, expiresAt et surtout un sessionToken ROTATIF.
        function applyServerSessionState(data) {
          // token
          if (typeof data?.sessionToken === "string" && data.sessionToken.trim()) {
            sessionToken = data.sessionToken.trim();
          }

          // iters
          if (Number.isFinite(Number(data?.itersLeft))) {
            itersLeft = Number(data.itersLeft);
          }

          // expiresAt (en secondes UNIX côté API -> ms ici)
          if (Number.isFinite(Number(data?.expiresAt))) {
            expiresAtMs = Number(data.expiresAt) * 1000;
          } else if (Number.isFinite(Number(data?.expiresAtMs))) {
            expiresAtMs = Number(data.expiresAtMs);
          }

          renderIters();

          if (expiresAtMs) startCountdown();
        }

        async function sendMessage() {
          if (isTyping) return;

          // Expiration locale si on la connaît déjà
          if (expiresAtMs && Date.now() >= expiresAtMs) {
            hardEndToExpiredScreen("Session expirée. Pour poursuivre, contactez GhostOps ou activez un format supérieur.");
            return;
          }

          if (lockIfNoIters()) return;

          const userMessage = (input.value || "").trim();
          if (!userMessage) return;

          addMessage("user", userMessage);
          convo.push({ role: "user", content: userMessage });

          input.value = "";

          const waiting = addMessage("bot", "Diagnostic IA en cours…");
          setLockedUI(true);

          try {
            const payload = {
              message: userMessage,
              contexte: "",
              enjeu: "",
              mode: "diagnostic-ia-session-v1",
              history: convo,
            };

            // 1er appel : on envoie cs_id si pas encore de token
            if (!sessionToken) {
              payload.cs_id = csId;
            } else {
              payload.sessionToken = sessionToken;
            }

            const resp = await fetch("/api/ghostops-diagnostic-ia", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                // double compat : header + body
                ...(sessionToken ? { Authorization: `Bearer ${sessionToken}` } : {}),
              },
              body: JSON.stringify(payload),
            });

            let data = {};
            try {
              data = await resp.json();
            } catch (_) {}

            if (waiting?.wrapper?.parentNode) waiting.wrapper.parentNode.removeChild(waiting.wrapper);

            if (!resp.ok) {
              const errMsg =
                data?.error ||
                `Une erreur est survenue lors du Diagnostic IA (HTTP ${resp.status}). Veuillez réessayer.`;

              // Cas “session terminée” (serveur)
              if (resp.status === 401 || resp.status === 403) {
                addMessage("bot", errMsg);
                hardEndToExpiredScreen("");
                return;
              }

              addMessage("bot", errMsg);
              setLockedUI(false);
              return;
            }

            if (!data?.reply) {
              addMessage("bot", "Réponse inattendue du serveur. Veuillez réessayer.");
              setLockedUI(false);
              return;
            }

            // ✅ Appliquer l’état serveur : token rotatif + itersLeft + expiresAt
            applyServerSessionState(data);

            // Ajouter réponse au contexte
            convo.push({ role: "assistant", content: String(data.reply) });

            addBotMessageTypewriter(String(data.reply));

            // Si le serveur dit 0 itérations restantes : écran fin
            if (itersLeft <= 0) {
              hardEndToExpiredScreen(
                "Vous avez atteint la limite des 5 itérations. Pour aller plus loin, GhostOps peut activer un Studio Scénarios ou produire une note Pré-brief Board."
              );
            }
          } catch (err) {
            console.error("Erreur lors de l’appel /api/ghostops-diagnostic-ia :", err);
            if (waiting?.wrapper?.parentNode) waiting.wrapper.parentNode.removeChild(waiting.wrapper);
            addMessage(
              "bot",
              "Erreur de connexion à GhostOps IA. Veuillez réessayer ultérieurement ou utiliser la page contact."
            );
            setLockedUI(false);
          }
        }

        if (form && input) {
          form.addEventListener("submit", (e) => {
            e.preventDefault();
            sendMessage();
          });

          input.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              sendMessage();
            }
          });
        }

        // Init
        openPaidUIOrFallback();
      })();
    </script>
  </body>
</html>
